# Athena MySQL Proxy Configuration

[server]
listen_addr = "127.0.0.1"
listen_port = 3307

# Circuit breaker / rate limiting configuration (deprecated, use per-instance limiter)
[circuit]
enabled = true
max_concurrent_per_user_shard = 10
queue_size = 100
queue_timeout_ms = 5000

# =============================================================================
# Sharding Group Configuration
# =============================================================================
# 
# 架构说明:
# - home: 非分片表的默认数据库 (athena_rs_test)
# - shard_0, shard_1: 分片数据库 0 (athena_shard_0) 的分表
# - shard_2, shard_3: 分片数据库 1 (athena_shard_1) 的分表
#
# 数据分布:
# - athena_rs_test: users (非分片表)
# - athena_shard_0: orders_0, orders_1
# - athena_shard_1: orders_2, orders_3

[[groups]]
name = "athena_rs_test"
user = "app_user"
password = "test123"

# Sharding rule: orders table sharded by user_id (string) using hash algorithm
# 4 shards = 2 databases × 2 tables per database
[[groups.sharding_rules]]
name = "order_shard"
table_pattern = "orders"
shard_column = "user_id"
algorithm = "hash"
shard_count = 4

# =============================================================================
# Home DB Group (for non-sharded tables)
# =============================================================================
[[groups.db_groups]]
name = "home"

[[groups.db_groups.instances]]
host = "10.78.81.148"
port = 3306
user = "rw_dbpaas"
password = "GpoqEDWg80vO"
database = "athena_rs_test"
role = "master"

# =============================================================================
# Shard DB 0: athena_shard_0 (orders_0, orders_1)
# =============================================================================
[[groups.db_groups]]
name = "shard_0"

[[groups.db_groups.instances]]
host = "10.78.81.148"
port = 3306
user = "rw_dbpaas"
password = "GpoqEDWg80vO"
database = "athena_shard_0"
role = "master"

[[groups.db_groups]]
name = "shard_1"

[[groups.db_groups.instances]]
host = "10.78.81.148"
port = 3306
user = "rw_dbpaas"
password = "GpoqEDWg80vO"
database = "athena_shard_0"
role = "master"

# =============================================================================
# Shard DB 1: athena_shard_1 (orders_2, orders_3)
# =============================================================================
[[groups.db_groups]]
name = "shard_2"

[[groups.db_groups.instances]]
host = "10.78.81.148"
port = 3306
user = "rw_dbpaas"
password = "GpoqEDWg80vO"
database = "athena_shard_1"
role = "master"

[[groups.db_groups]]
name = "shard_3"

[[groups.db_groups.instances]]
host = "10.78.81.148"
port = 3306
user = "rw_dbpaas"
password = "GpoqEDWg80vO"
database = "athena_shard_1"
role = "master"
